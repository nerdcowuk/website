import { notFound } from 'next/navigation';
import { GutenbergRenderer } from '@/components/GutenbergRenderer';
import Box from '@/components/blocks/Box/Box';
import Text from '@/components/blocks/Text/Text';
import { getPostBySlug } from '@/lib/wp-fetch';

interface PageProps {
	params: Promise<{
		slug: string;
	}>;
}

export default async function BlogPost({ params }: PageProps) {
	const { slug } = await params;
	const post = await getPostBySlug(slug);

	if (!post) {
		notFound();
	}

	// Parse Gutenberg blocks from content
	const blocks = post.blocks || [];

	return (
		<Box as={'article'}>

			<Box as={'header'}>
				{post.date && (
					<Text as="time">
						{new Date(post.date).toLocaleDateString('en-US', {
							year: 'numeric',
							month: 'long',
							day: 'numeric'
						})}
					</Text>
				)}

				<Text as="h1">{post.title.rendered}</Text>

				{post._embedded?.author && post._embedded.author[0] && (
					<Box>
						<Text>By {post._embedded.author[0].name}</Text>
					</Box>
				)}

				<Text>Summary bro...</Text>

				<svg xmlns="http://www.w3.org/2000/svg" width="129" height="24" fill="none" viewBox="0 0 129 24">
					<path fill="var(--ncos-colour-sys-primary)" d="M.572 21.03c3.708-2.366 7.202-5.473 10.809-8.047 2.876-2.366 7.139-5.395 6.95-9.49-.417-1.444-3.09-1.21-4.175-.612-1.514.806-2.56 2.782-3.191 4.81-1.741 4.759-.063 11.143 4.44 13.483 2.95 1.326 5.625-1.092 7.832-2.86 3.242-2.653 6.042-6.293 6.395-10.596.378-5.344-5.588-2.055-6.307.897-1.538 5.746 3.456 13.248 9.687 11.623 6.067-1.326 10.62-7.567 12.55-13.3.694-2.744.088-5.877-3.078-3.823-3.847 3.316-3.102 9.985-1.299 14.444 4.112 8.646 16.132-1.833 19.147-6.916 1.009-1.742 1.324-3.81.378-4.889-.87-1.118-2.876-1.274-4.15-.13-1.4.989-1.98 3.03-2.32 5.097-.707 4.07 1.526 7.944 5.6 8.438 5.688.793 12.348-3.706 13.596-9.504.316-1.443-.189-3.42-1.576-3.706-.946-.26-2.12 1.002-2.788 1.782-1.463 1.859-2.308 4.42-1.766 6.76 2.574 11.714 25.39 2.665 21.846-7.813-.277-.585-.429-1.015-1.047-.976-1.526.234-2.724 2.367-3.418 3.875-1.602 3.341-1.69 8.437 2.081 9.998 5.588 1.885 19.828-9.322 15.741-15.407-.933-.832-1.576-.61-2.144.52-1.148 2.536-1.64 6.189-.214 8.737 3.645 5.76 15.463.923 17.784-4.147.58-1.3.252-3.979-1.072-4.486-1.552-.364-3.179 1.587-3.948 3.004-1.955 3.549-2.006 8.632 2.649 9.672 3.758.897 8.917.52 11.856-2.184.82-.858 2.182.468 1.286 1.365-4.477 4.382-17.443 5.279-18.995-2.496-.87-4.615 2.435-12.598 7.808-11.532 1.526.507 2.396 1.963 2.749 3.42 1.842 7.826-9.497 12.819-15.577 12.48-5.007-.13-8.312-4.459-7.87-9.477.29-2.6.593-5.474 2.737-7.32 2.106-1.651 5.234.143 5.903 2.496 1.816 7.879-6.08 13.963-12.046 17.045-9.371 4.732-15.274-4.148-11.238-12.845 1.186-2.445 2.56-5.019 5.663-5.552 1.728-.312 3.469 1.248 3.936 2.808 3.884 11.805-13.862 21.01-22.893 15.94-4.818-2.692-6.067-9.595-3.267-14.223 1.501-2.406 3.52-4.993 6.774-4.499 3.317.65 4.616 4.447 3.998 7.346-.48 2.704-1.943 4.953-3.633 6.76-7.454 8.36-22.917 7.164-21.366-6.656.416-3.978 3.04-8.555 7.48-8.32 3.04-.053 5.638 3.25 5.057 6.266-.492 3.848-3.418 6.864-6.004 9.282-1.753 1.573-3.657 2.99-5.776 4.109-8.955 4.875-14.404-.624-14.883-10.167C36.96 6.6 38.915-.63 45.259.06c1.615.377 2.624 2.054 2.863 3.562.782 6.02-4.099 12.182-8.148 15.913-6.357 5.422-15.287 4.486-18.452-4.017-2.145-5.096-.606-11.35 5.07-12.975 2.17-.728 4.906.832 5.285 3.29.82 5.772-3.04 11.037-7.152 14.418-4.124 3.77-9.132 5.72-13.344.858-3.317-3.784-4.352-9.426-2.662-14.158.795-2.432 1.968-4.915 4.365-6.215 3.392-1.794 8.551-.299 7.517 4.381-.946 4.343-4.654 7.32-7.858 9.816-3.759 2.678-7.076 5.656-10.986 8.152a1.134 1.134 0 0 1-1.59-.403c-.327-.56-.163-1.3.392-1.638l.013-.013Z"/>
				</svg>
			</Box>

			{blocks.length > 0 ? (
				<GutenbergRenderer blocks={blocks} />
			) : (
				/* Fallback to rendered HTML if blocks aren't available */
				<div dangerouslySetInnerHTML={{ __html: post.content.rendered }} />
			)}
		</Box>
	);
}